"undefined"!=typeof __GAME_ENTRY__&&function(){"use strict";function t(s){function r(t){r.super(this);var i=0,n=[1,2,5,10,20],u=0,c=function(t){t>h&&(t=h),i=t,this.BetTxt.text=(t*l).toFixed(goblin.valuePrecision)}.bind(this);c(2),this.BtnBack.on(e.CLICK,this,function(){this.destroy()}),this.BtnReset.on(e.CLICK,this,function(){c(2),u=0}),this.BtnClose.on(e.CLICK,this,function(){this.destroy()});for(var d=0;d<n.length;++d){var g=n[d],b=this["Btn"+g.toString()];b.label="+"+g*l,b.on(e.CLICK,this,function(t){c(1==++u&&t>=10?t:i+t)},[g])}this.BtnMax.on(e.CLICK,this,function(){c(h)}),this.BtnOk.on(e.CLICK,this,function(){o.get_round_count(function(t,i){if(t)throw t;i.toNumber()!=f()?this.parent.addChild(new goblin.misc.Tips(goblin.texts[1049],function(){this.destroy(),k()}.bind(this))):x()}.bind(this))});var x=function(){var n=f();T()<=0&&++n;var e={to:o.address,value:s.ticket_price.mul(i),data:o.buy_tickets.getData("0x"+ethereumjs.Buffer.Buffer.from([i,t]).toString("hex"),n)},r=new goblin.misc.Loading(goblin.texts[1016]);this.parent.addChild(r),goblin.util.buildTxParams(e,goblin.privateKey).then(function(){return console.info("total value: ",web3.fromWei(e.value.toString(),"ether")),console.info("total fee: ",web3.fromWei(e.gasLimit.mul(e.gasPrice).toString(),"ether")),goblin.util.sendTransaction(e,goblin.privateKey)}).then(function(o){goblin.addPendingCoinFlippingRecord(o,e.gasLimit,n,{_coinSide:t,_rawType:[0==t?1062:1063]},l,a,i),this.parent.removeChild(r),this.parent.addChild(new goblin.misc.Tips(goblin.texts[1017],function(){this.destroy()}.bind(this)))}.bind(this)).catch(function(t){this.parent.removeChild(r),goblin.util.displayTransactionError(t,this.parent)}.bind(this))}.bind(this)}t.super(this);var a=s.odds_x_10.toNumber(),l=web3.fromWei(s.ticket_price,"ether").toNumber(),h=s.max_total_ticket_count.toNumber();Laya.class(r,"CoinFlippingBetInfo",Game2BetInfoUI),this.TxtHeadsRate.text=this.TxtTailsRate.text=(a/10).toString()+goblin.texts[1019],this.TxtHeadsMoney.text=this.TxtTailsMoney.text=goblin.texts[1060].format(0),this.BetMoney.text=this.BonusMoney.text="--";var u="0x"+ethereumjs.Util.privateToAddress(goblin.privateKey).toString("hex"),c=function(){o.get_ticket_counts_of_sides(function(t,i){if(t)throw t;this.TxtHeadsMoney.text=goblin.texts[1060].format(web3.fromWei(s.ticket_price.mul(i[0]),"ether").toNumber().toFixed(goblin.valuePrecision)),this.TxtTailsMoney.text=goblin.texts[1060].format(web3.fromWei(s.ticket_price.mul(i[1]),"ether").toNumber().toFixed(goblin.valuePrecision))}.bind(this)),web3.eth.getBalance(u,function(t,i){if(t)throw t;this.BetMoney.text=web3.fromWei(i,"ether").toNumber().toFixed(goblin.valuePrecision),this.Txt1.text=goblin.currencyName}.bind(this)),goblin.contract.bank.get_balance({from:u},function(t,i){if(t)throw t;this.BonusMoney.text=web3.fromWei(i,"ether").toNumber().toFixed(goblin.valuePrecision),this.Txt2.text=goblin.currencyName}.bind(this))}.bind(this);c(),this.timer.loop(15e3,this,c),this.BtnBack.on(e.CLICK,this,function(){this.parent.removeChild(this)}),this.BtnHeads.on(e.CLICK,this,function(){this.parent.addChild(new r(0))}),this.BtnTails.on(e.CLICK,this,function(){this.parent.addChild(new r(1))}),this.BtnReport.on(e.CLICK,this,function(){this.parent.addChild(new i(x(),f()))}),this.BtnRecord.on(e.CLICK,this,function(){this.parent.addChild(new n)});var d=s.round_count.toNumber(),g=s.lucky_sides,b=goblin.util.uint256ToHash(s.lucky_block_hash),f=function(){return d},x=function(){return g},p=function(){for(var t=0;t<g.length&&g[t]==goblin.coinFlipping.NO_SIDE;++t);var i=t==g.length?0:g[t];this.ResultTxt.text=goblin.texts[1064].format(d-t),this.Coin.skin=0==i?"resource/coin_heads.png":"resource/coin_tails.png",web3.eth.getBlock(b,function(t,i){if(t)throw t;i||(i={number:0,timestamp:0});var n=this.TxtResultContainer,e=this.TxtResult,o="<div style='position:fixed;padding:0;margin:0;top:0;left:0;width:100%;height:100%;color:#bbbbbb;fontSize:24;font-weight:bold'><p>{}{{}}</p><br/><p>{}{{}}</p><br/><p>{}{{}}..{{}}<font color='gold'>{{}}</font></p></div>".format(goblin.texts[1068],goblin.texts[1069],goblin.texts[1070]);this.href="https://etherscan.io/block/"+i.number,e||((e=new Laya.HTMLDivElement).width=n.width,e.height=n.height,e.x=0,e.y=0,n.addChild(e),this.TxtResult=e);var s=new Date;s.setTime(1e3*i.timestamp);var r=s.getFullYear()+"-"+("00"+(s.getMonth()+1)).slice(-2)+"-"+("00"+s.getDate()).slice(-2)+" "+("00"+s.getHours()).slice(-2)+":"+("00"+s.getMinutes()).slice(-2)+":"+("00"+s.getSeconds()).slice(-2),a=b.substring(0,2)+"0".repeat(66-b.length)+b.substring(2);e.innerHTML=o.format(i.number,r,a.substring(0,9),a.substring(a.length-7,a.length-1),a.substring(a.length-1))}.bind(this))}.bind(this),_=function(t,i,n){void 0==i?i=goblin.coinFlipping.NO_SIDE:b=n,t<=d?(g[d-t]=i,p()):(g.unshift(i),d=t)};p();var m,C=o.RoundStart(function(t,i){if(t)throw t;var n=i.args.round_count.toNumber();this.parent&&this.parent.addChild(new goblin.misc.Tips(goblin.texts[1023].format(n))),o.get_deadline(function(t,i){if(t)throw t;v(i.toNumber())}),_(n)}.bind(this)),y=o.RoundEnd(function(t,i){if(t)throw t;var n=i.args.round_count.toNumber(),e=i.args.lucky_side.toNumber(),o=goblin.util.uint256ToHash(i.args.lucky_block_hash);this.parent&&this.parent.addChild(new goblin.misc.Tips(goblin.texts[1066].format(n,goblin.texts[0==e?1062:1063]))),f()==n&&v(0),_(n,e,o)}.bind(this)),v=function(t){0==t?(m=-1,this.TimeTxt.text=goblin.texts[1067].format(d+1)):(m=Math.max(t-Math.floor(Date.now()/1e3),0),this.TimeTxt.text=goblin.texts[1067].format(d)),w(0)}.bind(this),T=function(){return m},w=function(t){var i;m<0?i=goblin.texts[1020]:(m+=t)<0?(m=0,i=goblin.texts[1021]):i=goblin.util.secondsToHHMMSS(m),this.NextTime.text=i}.bind(this);v(s.deadline.toNumber()),this.timer.loop(1e3,this,function(){w(-1)});var k=function(){C.stopWatching(),y.stopWatching(),this.destroy()}.bind(this)}function i(t,n){i.super(this),this.BtnClose.on(e.CLICK,this,function(){this.destroy()});for(var o=[],s=0;s<t.length;++s){var r=t[s];if(r!=goblin.coinFlipping.NO_SIDE&&(o.push({Round:goblin.texts[1029].format(n-s),Coin:0==r?"resource/coin_heads.png":"resource/coin_tails.png"}),12==o))break}this.HistoryList.array=o,0==o.length?this.Desc.text=goblin.texts[1065]:this.Desc.text=""}function n(){n.super(this),this.BtnClose.on(e.CLICK,this,function(){this.destroy()}),this.RecordList.array=[],this.Desc.text=goblin.texts[1001],goblin.updateRecords(function(t){for(var i=[],n=0;n<t.length;++n){var e=t[n]._raw;if(e._type==goblin.RECORD_TYPE_COIN_FLIPPING){var o={Round:goblin.util.makeText(e._rawRound),Coin:0==e._coinSide?"resource/coin_heads.png":"resource/coin_tails.png"};if(void 0==e._luckySide?(o.Status=goblin.util.makeText(e._rawText),o.BetMoney=goblin.util.makeText(e._rawPrice),o.BonueMoney=""):void 0==e._bonus?(o.Status=goblin.util.makeText(e._rawText),o.BetMoney=goblin.util.makeText(e._rawPrice),o.BonueMoney=""):(o.Status=goblin.texts[1032],o.BetMoney="",o.BonueMoney=e._bonus.toFixed(goblin.valuePrecision)+" "+goblin.currencyName),i.push(o),6==i)break}}this.RecordList.array=i,0==i.length?this.Desc.text=goblin.texts[1065]:this.Desc.text=""}.bind(this))}goblin.coinFlipping={NO_SIDE:255};laya.utils.Handler;var e=laya.events.Event,o=goblin.contract.coinFlipping,s=function(t){var i={},n=!1,e=0,s=function(o,s,r){n||(o?(n=!0,t(o)):(i[s]=r,0==--e&&t(null,i)))};o.get_ticket_price(function(t,i){s(t,"ticket_price",i)}),++e,o.get_odds_x_10(function(t,i){s(t,"odds_x_10",i)}),++e,o.get_max_total_ticket_count(function(t,i){s(t,"max_total_ticket_count",i)}),++e,o.get_deadline(function(t,i){s(t,"deadline",i)}),++e,o.get_round_count(function(t,i){s(t,"round_count",i)}),++e,o.get_lucky_sides(function(t,i){s(t,"lucky_sides",i)}),++e,o.get_lucky_block_hash(function(t,i){s(t,"lucky_block_hash",i)}),++e};Laya.class(t,"CoinFlippingMain",GameMain2UI),Laya.class(i,"CoinFlippingReport",Game2ReportUI),Laya.class(n,"CoinFlippingRecord",Game2RecordUI),goblin.newCoinFlippingMain=function(i,n){var e=new goblin.misc.Loading(goblin.texts[1001]);i.addChild(e),s(function(o,s){if(i.removeChild(e),o)throw o;var r=new t(s);i.addChild(r),n(r)})}}();