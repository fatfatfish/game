goblin.util=new function(){"use strict";this.gasPriceScale=function(e){return e.dividedBy(1)},this.randomBetween=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},this.secondsToHHMMSS=function(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),i=e-3600*t-60*n;return t<10&&(t="0"+t),n<10&&(n="0"+n),i<10&&(i="0"+i),t+":"+n+":"+i},this.buildTxParams=function(e,t){return new Promise(function(n,i){e.from="0x"+ethereumjs.Util.privateToAddress(t).toString("hex"),web3.eth.getTransactionCount(e.from,function(t,r){t?i(t):(e.nonce=r,n())})}).then(function(){return new Promise(function(t,n){web3.eth.getGasPrice(function(i,r){i?n(i):(console.log("gas price = "+r),e.gasPrice=goblin.util.gasPriceScale(r),t())})})}).then(function(){return new Promise(function(t,n){web3.eth.estimateGas(e,function(i,r){i?n(i):(e.gasLimit=new web3.BigNumber(r),t())})})})};var e=function(e,t){return new Promise(function(n,i){void 0!=e.nonce&&(e.nonce=web3.toHex(e.nonce.toString())),void 0!=e.gasPrice&&(e.gasPrice=web3.toHex(e.gasPrice.toString())),void 0!=e.gasLimit&&(e.gasLimit=web3.toHex(e.gasLimit.mul(2).toString())),void 0!=e.value&&(e.value=web3.toHex(e.value.toString()));var r=new ethereumjs.Tx(e);r.sign(t),web3.eth.sendRawTransaction("0x"+r.serialize().toString("hex"),function(e,t){e?i(e):n(t)})})};this.sendTransaction=e;var t=function(e,t){return new Promise(function(n,i){var r=function(){web3.eth.getTransactionReceipt(e,function(o,a){if(o){if("unknown transaction"==o.message)return void setTimeout(r,1e3);i(o)}else{if(!a)return void setTimeout(r,1e3);new web3.BigNumber(a.gasUsed).eq(t)?i(Error("unknown error")):n(e)}})};r()})};this.getTransactionReceipt=t,this.sendTransactionAndGetReceipt=function(n,i){return e(n,i).then(function(e){return t(e,n.gasLimit)})},this.makeText=function(e){if("string"==typeof e)return e;var t=e[0],n=Array.prototype.slice.call(e,1);return String.prototype.format.apply(goblin.texts[t],n)},this.padNumber=function(e,t,n){return(t.repeat(n)+e.toString()).slice(-n)},this.copyToClipboard=function(e){document.getElementById("text-to-copy").textContent=e;document.getElementById("copy-helper").style.display="inherit"},this.uint256ToHash=function(e){var t=web3.toHex(e);return t=t.substring(0,2)+"0".repeat(66-t.length)+t.substring(2)},this.uint256ToAddress=function(e){var t=web3.toHex(e);return t=t.substring(0,2)+"0".repeat(42-t.length)+t.substring(2)},this.drawQRCode=function(e,t){var n=new QRCode(Laya.Browser.document.createElement("div"),{width:t.width,height:t.height});n.makeCode(e);var i=setInterval(function(){var e=n._oDrawing._elImage.src;e&&(clearInterval(i),t.loadImage(e))}.bind(this),100)},this.displayTransactionError=function(e,t){switch(e.message){case"replacement transaction underpriced":t.addChild(new goblin.misc.Tips(goblin.texts[1045]));break;case"insufficient funds for gas * price + value":t.addChild(new goblin.misc.Tips(goblin.texts[1124]));break;case"unknown error":case"gas required exceeds allowance or always failing transaction":t.addChild(new goblin.misc.Tips(goblin.texts[1125]));break;default:alert("Error: "+e.message)}}};