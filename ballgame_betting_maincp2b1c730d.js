"undefined"!=typeof __GAME_ENTRY__&&function(){"use strict";function t(a){function o(t){var n=s.BettingType.ODD_EVEN;o.super(this),this.BettingList.vScrollBarSkin="";var r=["BetOdd","BetEven"],a=function(t,e){_.toggleBettingResult(this.BettingList.array[t][e]._bettingResult),L(this)},l=null,g=function(e){_.clearBetting(this.BettingList.array[e]._betting),this.BettingList.array.splice(e,1),this.BettingList.refresh(),t.BettingList.refresh(),L(t),l&&l()};if(this.BettingList.renderHandler=new e(this,function(e,n){for(var s=0;s<r.length;++s){var o=r[s],l=e.getChildByName(o);t||this.BettingList.array[n].isEnded?l.mouseEnabled=!1:l.on(i.CLICK,this,a,[n,o]),l.selected=_.testBettingResult(this.BettingList.array[n][o]._bettingResult)}var h=e.getChildByName("BtnDelete");t?h.on(i.CLICK,this,g,[n]):h.visible=!1}),t){for(var h=t.BettingList.array,u=[],c=0;c<h.length;++c){var B=h[c],f=B._betNameTextIDs=[];if(_.testBetting(B._betting)){for(var d=0;d<r.length;++d){var b=r[d];_.testBettingResult(B[b]._bettingResult)&&f.push(B[b]._labelBasicTextID)}u.push(B)}}this.BettingList.array=u,this.user_clearChosen=function(){_.clearBettings(n),t.BettingList.refresh(),L(t)},this.user_getBetInfos=function(t){for(var e=[],i=0;i<this.BettingList.array.length;++i){var n=this.BettingList.array[i];n._betInfos=_.getBetInfos(n._betting,t),Array.prototype.push.apply(e,n._betInfos)}return e},this.user_onDelete=function(t){l=t}}else this.user_setList=function(t){_.clearUnmarkedBettingsBegin(n);for(var e=0;e<t.length;++e)_.markBetting(t[e]._betting);_.clearUnmarkedBettingsEnd(),L(this),this.BettingList.array=t},this.user_getChosenCount=function(){return _.getNumberOfBettingResults(n)},this.user_copyChosen=function(){return new o(this)}}function l(t){var n=s.BettingType.WIN_LOSE_DRAW;l.super(this),this.BettingList.vScrollBarSkin="";var r=["BetHome","BetVisitor","BetDraw"],a=function(t,e){_.toggleBettingResult(this.BettingList.array[t][e]._bettingResult),L(this)},o=null,g=function(e){_.clearBetting(this.BettingList.array[e]._betting),this.BettingList.array.splice(e,1),this.BettingList.refresh(),t.BettingList.refresh(),L(t),o&&o()};if(this.BettingList.renderHandler=new e(this,function(e,n){for(var s=0;s<r.length;++s){var o=r[s],l=e.getChildByName(o);t||this.BettingList.array[n].isEnded?l.mouseEnabled=!1:l.on(i.CLICK,this,a,[n,o]),l.selected=_.testBettingResult(this.BettingList.array[n][o]._bettingResult)}var h=e.getChildByName("BtnDelete");t?h.on(i.CLICK,this,g,[n]):h.visible=!1}),t){for(var h=t.BettingList.array,u=[],c=0;c<h.length;++c){var B=h[c],f=B._betNameTextIDs=[];if(_.testBetting(B._betting)){for(var d=0;d<r.length;++d){var b=r[d];_.testBettingResult(B[b]._bettingResult)&&f.push(B[b]._labelBasicTextID)}u.push(B)}}this.BettingList.array=u,this.user_clearChosen=function(){_.clearBettings(n),t.BettingList.refresh(),L(t)},this.user_getBetInfos=function(t){for(var e=[],i=0;i<this.BettingList.array.length;++i){var n=this.BettingList.array[i];n._betInfos=_.getBetInfos(n._betting,t),Array.prototype.push.apply(e,n._betInfos)}return e},this.user_onDelete=function(t){o=t}}else this.user_setList=function(t){_.clearUnmarkedBettingsBegin(n);for(var e=0;e<t.length;++e)_.markBetting(t[e]._betting);_.clearUnmarkedBettingsEnd(),L(this),this.BettingList.array=t},this.user_getChosenCount=function(){return _.getNumberOfBettingResults(n)},this.user_copyChosen=function(){return new l(this)}}function g(t){var n=s.BettingType.SCORES;g.super(this),this.BettingList.vScrollBarSkin="";var r=["Bet10","Bet00","Bet01","Bet20","Bet11","Bet02","Bet21","Bet22","Bet12","BetWin","BetDraw","BetLose"],a=function(t){var e=this.BettingList.array[t];u.parent.addChild(new v(e,function(){this.BettingList.refresh(),L(this)}.bind(this)))},o=null,l=function(e){_.clearBetting(this.BettingList.array[e]._betting),this.BettingList.array.splice(e,1),this.BettingList.refresh(),t.BettingList.refresh(),L(t),o&&o()};if(this.BettingList.renderHandler=new e(this,function(e,n){var s=e.getChildByName("BtnChoose");this.BettingList.array[n].isEnded&&(s.mouseEnabled=!1),t||s.on(i.CLICK,this,a,[n]);for(var o=this.BettingList.array[n],g="",h=0;h<r.length;++h){var u=r[h];_.testBettingResult(o[u]._bettingResult)&&(g+=goblin.texts[o[u]._labelBasicTextID]+", ")}0==g.length?(g=goblin.texts[1088],s.selected=!1):(g=g.substr(0,g.length-2),s.selected=!0),s.label=g;var c=e.getChildByName("BtnDelete");t?c.on(i.CLICK,this,l,[n]):c.visible=!1}),t){for(var h=t.BettingList.array,c=[],B=0;B<h.length;++B){var f=h[B],d=f._betNameTextIDs=[];if(_.testBetting(f._betting)){for(var b=0;b<r.length;++b){var m=r[b];_.testBettingResult(f[m]._bettingResult)&&d.push(f[m]._labelBasicTextID)}c.push(f)}}this.BettingList.array=c,this.user_clearChosen=function(){_.clearBettings(n),t.BettingList.refresh(),L(t)},this.user_getBetInfos=function(t){for(var e=[],i=0;i<this.BettingList.array.length;++i){var n=this.BettingList.array[i];n._betInfos=_.getBetInfos(n._betting,t),Array.prototype.push.apply(e,n._betInfos)}return e},this.user_onDelete=function(t){o=t}}else{this.user_setList=function(t){_.clearUnmarkedBettingsBegin(n);for(var e=0;e<t.length;++e)_.markBetting(t[e]._betting);_.clearUnmarkedBettingsEnd(),L(this),this.BettingList.array=t};var v=function(t,e){v.super(this),this.HomeName.text=t.HomeName,this.VisitorName.text=t.VisitorName;for(var n=[],s=function(t){var e=n.indexOf(t);e<0?n.push(t):n.splice(e,1)},a=0;a<r.length;++a){var o=r[a],l=this[o],g=t[o]._bettingResult;l.label=t[o].label,l.on(i.CLICK,this,s,[g]),l.selected=_.testBettingResult(g),this[o+"Per"].text=t[o+"Per"]}this.BtnConfirm.on(i.CLICK,this,function(){for(var t=0;t<n.length;++t){var i=n[t];_.toggleBettingResult(i)}e(),this.destroy()}),this.BtnCancel.on(i.CLICK,this,function(){this.destroy()})};Laya.class(v,"BallgameBetScoreInfo",BetScoreInfoUI),this.user_getChosenCount=function(){return _.getNumberOfBettingResults(n)},this.user_copyChosen=function(){return new g(this)}}}function h(t){h.super(this),this.OrderList.addChild(t),this.BtnBack.on(i.CLICK,this,function(){this.destroy()}),this.BtnClear.on(i.CLICK,this,function(){this.parent.addChild(new goblin.misc.Confirm(goblin.texts[1126],function(){t.user_clearChosen(),this.destroy()}.bind(this)))}),this.BtnRate.on(i.CLICK,this,function(){this.RateList.visible=!0}),this.BtnHideRateList.on(i.CLICK,this,function(){this.RateList.visible=!1}),this.BtnRate50.on(i.CLICK,this,function(){this.RateList.visible=!1,s(50-e)}),this.BtnRate20.on(i.CLICK,this,function(){this.RateList.visible=!1,s(20-e)}),this.BtnRate10.on(i.CLICK,this,function(){this.RateList.visible=!1,s(10-e)}),this.BtnAdd.on(i.CLICK,this,function(){s(1)}),this.BtnDec.on(i.CLICK,this,function(){s(-1)});var e=1,s=function(t){e+t<1||(e+=t,this.RateTxt.text=e.toString()+goblin.texts[1019],l())}.bind(this),r=null,o=null;t.user_onDelete(function(){l()});var l=function(){if(r=t.user_getBetInfos(a.ticket_price.mul(e).toString()),(o=r.length)*e>B){var i=Math.floor(B/o);s(i-e),this.parent.addChild(new goblin.misc.Tips(goblin.texts[1056].format(B)))}var n=o*e;this.BetTxt.text=goblin.texts[1018].format(n,(n*c).toFixed(goblin.valuePrecision)+" "+goblin.currencyName),this.BtnPay.disabled=0==n}.bind(this);s(0),this.BtnPay.on(i.CLICK,this,function(){var i=new ethers.Interface(n.abi),s={to:n.address,value:new web3.BigNumber(a.ticket_price.toString()).mul(o*e),data:i.functions.bet(r).data},l=new goblin.misc.Loading(goblin.texts[1016]);this.parent.addChild(l),goblin.util.buildTxParams(s,goblin.privateKey).then(function(){return console.info("total value: ",web3.fromWei(s.value.toString(),"ether")),console.info("total fee: ",web3.fromWei(s.gasLimit.mul(s.gasPrice).toString(),"ether")),goblin.util.sendTransaction(s,goblin.privateKey)}).then(function(i){goblin.addPendingBallgameBettingRecords(i,s.gasLimit,t.BettingList,c,e),this.parent.removeChild(l),this.parent.addChild(new goblin.misc.Tips(goblin.texts[1017],function(){t.user_clearChosen(),this.destroy()}.bind(this)))}.bind(this)).catch(function(t){this.parent.removeChild(l),goblin.util.displayTransactionError(t,this.parent)}.bind(this))})}t.super(this);var u=this,c=0,B=0;Laya.class(o,"BallgameBetGoal",BetGoalUI),Laya.class(g,"BallgameBetScore",BetScoreUI),Laya.class(l,"BallgameBetWinlose",BetWinloseUI),Laya.class(h,"BallgameOrderList",FootBallOrderListUI);var f=new o,d=new g,b=new l,_=new goblin.BallgameBettingCart,m=[b,d,f],v=null,C=function(t){var e=m.indexOf(t);this.BtnType.selectedIndex=e,this.BtnType.selectedIndex!=e&&(this.BtnType.selectedIndex=e),t!=v&&(v&&this.GameMain.removeChild(v),v=t,L(t),this.GameMain.addChild(v))}.bind(this),L=function(t){if(t==v){var e=t.user_getChosenCount();this.BetTxt.text=goblin.texts[1018].format(e,(e*c).toFixed(goblin.valuePrecision)+" "+goblin.currencyName),this.BtnOk.disabled=0==e}}.bind(this);C(m[0]),this.BtnType.on(i.CLICK,this,function(){var t=m[this.BtnType.selectedIndex];C(t)});var y=function(t){return Math.floor(Date.now()/1e3)>t.betting_stop_time.toNumber()},p=function(t){var e=Math.floor(Date.now()/1e3);c=Number(web3.fromWei(t.ticket_price,"ether")),B=Number(t.max_total_ticket_count);var i={};i[s.BettingType.WIN_LOSE_DRAW]=[],i[s.BettingType.ODD_EVEN]=[],i[s.BettingType.SCORES]=[];for(I=0;I<t.matches.length;++I){if(!((m=t.matches[I]).betting_start_time.toNumber()>=e||m.betting_stop_time.toNumber()<e-86400)){for(var n=!1,r=0;r<m.bettings.length;++r){if(void 0==i[(R=m.bettings[r]).data.type]){n=!0;break}}if(!n)for(r=0;r<m.bettings.length;++r){i[(R=m.bettings[r]).data.type].push(R)}}}var a,o,l,g=function(t){var e=new Date;e.setTime(1e3*t);var i="";return t<=Math.floor(Date.now()/1e3)&&(i="(投注已截止)"),("00"+(e.getMonth()+1)).slice(-2)+"-"+("00"+e.getDate()).slice(-2)+" "+("00"+e.getHours()).slice(-2)+":"+("00"+e.getMinutes()).slice(-2)+i},h=goblin.config.ballgameBetting,u=10*(100-t.water_percent.toNumber());a=i[s.BettingType.ODD_EVEN],o=[],l={BetOdd:[s.OddEven.ODD,1074],BetEven:[s.OddEven.EVEN,1075]};for(I=0;I<a.length;++I){var _=(R=a[I]).total_value,m=R.parent,v=y(m),C={TotalBonus:Number(web3.fromWei(_.toString(),"ether")).toFixed(goblin.valuePrecision)+" "+goblin.currencyName,GameType:h.leagueName(m.data.league_id),HomeName:h.teamName(m.data.team1_id),VisitorName:h.teamName(m.data.team2_id),EndTime:g(m.betting_stop_time.toNumber()),_rawType:[1089],_betting:R,isEnded:v};for(var L in l){var p=l[L],N=(x=R.result_of_type[p[0]]).total_value,S=goblin.texts[p[1]];v&&(S="{} ({})".format(goblin.texts[p[1]],N.eq(0)?"--":_.mul(u).div(N).toNumber()/1e3)),C[L]={label:S,selected:!1,_labelBasicTextID:p[1],_bettingResult:x},C[L+"Per"]="{}%".format(_.eq(0)?"--":N.mul(1e3).div(_).toNumber()/10)}o.unshift(C)}f.user_setList(o),a=i[s.BettingType.WIN_LOSE_DRAW],o=[],l={BetHome:[s.WinLoseDraw.WIN,1071],BetVisitor:[s.WinLoseDraw.LOSE,1072],BetDraw:[s.WinLoseDraw.DRAW,1073]};for(I=0;I<a.length;++I){var _=(R=a[I]).total_value,m=R.parent,v=y(m),C={TotalBonus:Number(web3.fromWei(_.toString(),"ether")).toFixed(goblin.valuePrecision)+" "+goblin.currencyName,GameType:h.leagueName(m.data.league_id),HomeName:h.teamName(m.data.team1_id),VisitorName:h.teamName(m.data.team2_id),EndTime:g(m.betting_stop_time.toNumber()),_rawType:[1090],_betting:R,isEnded:v};for(var L in l){var p=l[L],S=goblin.texts[p[1]],N=(x=R.result_of_type[p[0]]).total_value;v&&(S="{} ({})".format(goblin.texts[p[1]],N.eq(0)?"--":_.mul(u).div(N).toNumber()/1e3)),C[L]={label:S,selected:!1,_labelBasicTextID:p[1],_bettingResult:x},C[L+"Per"]="{}%".format(_.eq(0)?"--":N.mul(1e3).div(_).toNumber()/10)}o.unshift(C)}b.user_setList(o),a=i[s.BettingType.SCORES],o=[],l={Bet00:[s.Scores.SCORES_0V0,1076],Bet01:[s.Scores.SCORES_0V1,1077],Bet10:[s.Scores.SCORES_1V0,1078],Bet02:[s.Scores.SCORES_0V2,1079],Bet20:[s.Scores.SCORES_2V0,1080],Bet11:[s.Scores.SCORES_1V1,1081],Bet12:[s.Scores.SCORES_1V2,1082],Bet21:[s.Scores.SCORES_2V1,1083],Bet22:[s.Scores.SCORES_2V2,1084],BetWin:[s.Scores.SCORES_WIN,1085],BetLose:[s.Scores.SCORES_LOSE,1086],BetDraw:[s.Scores.SCORES_DRAW,1087]};for(var I=0;I<a.length;++I){var R=a[I],_=R.total_value,m=R.parent,v=y(m),C={TotalBonus:Number(web3.fromWei(_.toString(),"ether")).toFixed(goblin.valuePrecision)+" "+goblin.currencyName,GameType:h.leagueName(m.data.league_id),HomeName:h.teamName(m.data.team1_id),VisitorName:h.teamName(m.data.team2_id),EndTime:g(m.betting_stop_time.toNumber()),_rawType:[1091],_betting:R,isEnded:v};for(var L in l){var p=l[L],x=R.result_of_type[p[0]],N=x.total_value,S=goblin.texts[p[1]];v&&(S="{} ({})".format(goblin.texts[p[1]],N.eq(0)?"--":_.mul(u).div(N).toNumber()/1e3)),C[L]={label:S,selected:!1,_labelBasicTextID:p[1],_bettingResult:x},C[L+"Per"]="{}%".format(_.eq(0)?"--":N.mul(1e3).div(_).toNumber()/10)}o.unshift(C)}d.user_setList(o)};p(a),setInterval(function(){r(function(t,e){if(t)throw t;p(e),a=e})},15e3),this.BtnBack.on(i.CLICK,this,function(){this.parent.removeChild(this)}),this.BtnOk.on(i.CLICK,this,function(){this.addChild(new h(v.user_copyChosen()))})}var e=laya.utils.Handler,i=laya.events.Event,n=goblin.contract.ballgameBetting,s=goblin.protocol.ballgameBetting,r=function(t){var e={},i=!1,r=0,a=function(n,s,a){i||(n?(i=!0,t(n)):(e[s]=a,0==--r&&t(null,e)))};new ethers.Contract(n.address,n.abi,new ethers.providers.Web3Provider(web3.currentProvider)).get_matches().then(function(t){for(var e=0;e<t.length;++e){var i=t[e];i.length=0,i.betting_of_type={},i.data=s.Match.decode(ethereumjs.Buffer.Buffer.from(i.data.substr(2),"hex"));for(var n=0;n<i.bettings.length;++n){var r=i.bettings[n];r.length=0,r.parent=i,r.index=n,r.result_of_type={},r.total_value=new ethers.utils.BigNumber(0),r.better_count=0,r.data=s.Betting.decode(ethereumjs.Buffer.Buffer.from(r.data.substr(2),"hex")),i.betting_of_type[r.data.type]=r;for(var o=0;o<r.results.length;++o){var l=r.results[o];l.length=0,l.parent=r,l.index=o,l.data=s.BettingResult.decode(ethereumjs.Buffer.Buffer.from(l.data.substr(2),"hex")),r.result_of_type[l.data[l.data.value]]=l,r.total_value=r.total_value.add(l.total_value),r.better_count+=r.better_count}}}a(null,"matches",t)}).catch(function(t){a(t)}),++r,n.get_water_percent(function(t,e){a(t,"water_percent",e)}),++r,n.get_ticket_price(function(t,e){a(t,"ticket_price",e)}),++r,n.get_max_total_ticket_count(function(t,e){a(t,"max_total_ticket_count",e)}),++r};Laya.class(t,"BallgameBettingMain",GameMain3UI),goblin.newBallgameBettingMain=function(e,i){var n=new goblin.misc.Loading(goblin.texts[1001]);e.addChild(n),r(function(s,r){if(e.removeChild(n),s)throw s;var a=new t(r);e.addChild(a),i(a)})}}();